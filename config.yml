rules:
  # ===================================================================
  # == å†…å®¹è§„åˆ™é›† 1: é’ˆå¯¹ "item" ç±»å‹çš„è½¬æ¢
  # ===================================================================
  - name: "Minecraft ç‰©å“æ•°æ®è¿ç§» (v1 -> v2)"
    content: "item" # æ­¤è§„åˆ™é›†åº”ç”¨äº YAML æ–‡ä»¶ä¸­æ‰€æœ‰ 'items' å¼€å¤´çš„é¡¶çº§é”®

    # -----------------------------------------------------------------
    # âœ¨ CONTEXT BLOCK: å®šä¹‰å¯åœ¨æ­¤è§„åˆ™é›†ä¸­é‡ç”¨çš„åŠ¨æ€å˜é‡
    # å˜é‡æŒ‰é¡ºåºè¯„ä¼°ï¼Œåé¢çš„å¯ä»¥å¼•ç”¨å‰é¢çš„ã€‚
    # -----------------------------------------------------------------
    context:
      # ä» ID (å¦‚ 'diamond_pickaxe') æå–æè´¨ ('diamond')
      material:
        expression: "content_id.split('_')[0] if '_' in content_id else 'unknown'"
        default_value: "generic" # è¡¨è¾¾å¼å¤±è´¥æ—¶çš„åå¤‡å€¼

      # ä»åŸå§‹æ•°æ®ä¸­å®‰å…¨åœ°è·å–ç­‰çº§ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™é»˜è®¤ä¸º 0
      level:
        expression: "get(data, 'old_stats.level', 0)"

      # åŸºäº 'level' å’Œ 'material' åˆ¤æ–­ç¨€æœ‰åº¦
      rarity:
        expression: >- # ä½¿ç”¨ >- ä¿ç•™æ¢è¡Œç¬¦ï¼Œä¾¿äºé˜…è¯»é•¿è¡¨è¾¾å¼
          'Legendary' if level > 5 and material in ['diamond', 'netherite']
          else 'Rare' if level > 3
          else 'Common'

      # åˆ¤æ–­æ˜¯å¦ä¸ºç‰¹æ®Šç‰©å“ (å¸ƒå°”å€¼)
      is_special:
        expression: "rarity != 'Common' or get(data, 'legacy_properties.is_quest_item', False)"

      # ç»„åˆå…¶ä»–ä¸Šä¸‹æ–‡å˜é‡æ¥ç”Ÿæˆä¸€ä¸ªæ–°çš„æ˜¾ç¤ºåç§°
      new_display_name:
        expression: "f'[{rarity}] {material.replace('_', ' ').title()}'"

    # -----------------------------------------------------------------
    # ğŸ“œ RULES LIST: é’ˆå¯¹ 'item' çš„å…·ä½“è½¬æ¢è§„åˆ™
    # -----------------------------------------------------------------
    rules:
      - name: "Rule_A_Cleanup"
        # æ— æ¡ä»¶ï¼Œé¦–å…ˆå¯¹æ‰€æœ‰ç‰©å“æ‰§è¡Œæ¸…ç†å’Œé‡å‘½å
        actions:
          delete:
            - legacy_properties # åˆ é™¤æ•´ä¸ªæ—§çš„å±æ€§å—
            - temp_notes      # åˆ é™¤ä¸´æ—¶ç¬”è®°å­—æ®µ
          rename:
            old_stats: stats # å°† 'old_stats' é‡å‘½åä¸º 'stats'

      - name: "Rule_B_SetCoreData"
        # æ­¤è§„åˆ™ä¾èµ–äºå‰ä¸€ä¸ªæ¸…ç†è§„åˆ™çš„å®Œæˆ
        depends_on: "Rule_A_Cleanup" 
        conditions:
          # ä½¿ç”¨è¡¨è¾¾å¼ä½œä¸ºæ¡ä»¶ï¼Œåªæœ‰æè´¨è¢«æˆåŠŸè¯†åˆ«çš„ç‰©å“æ‰ä¼šç»§ç»­
          - "material != 'unknown'"
        actions:
          set:
            # ç”¨æ³•1: ä½¿ç”¨ context å˜é‡é€šè¿‡è¡¨è¾¾å¼è®¾ç½®å€¼
            display_name:
              expression: "new_display_name"
            # ç”¨æ³•2: é™æ€å€¼
            schema_version: "v2.0"
            is_migrated: true
            # ç”¨æ³•3: ä½¿ç”¨ç®€å•å ä½ç¬¦ï¼ˆä»ç„¶æ”¯æŒï¼‰
            description: "A {rarity} item made of {material}."
            # ç”¨æ³•4: è¡¨è¾¾å¼è®¡ç®—å¤±è´¥æ—¶çš„åå¤‡å€¼
            stats.attack_power:
              expression: "stats.damage * 1.5" # å¦‚æœ 'stats.damage' ä¸å­˜åœ¨ï¼Œæ­¤è¡¨è¾¾å¼ä¼šå¤±è´¥
              default_value: 5 # å¤±è´¥æ—¶ï¼Œå°† attack_power è®¾ä¸º 5

      - name: "Rule_C_HandleTagsAndLore"
        conditions:
          # ä»…å¯¹è¢«åˆ¤å®šä¸º 'special' çš„ç‰©å“æ‰§è¡Œ
          - "is_special == True"
        actions:
          # åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å…ƒç´ 
          append:
            tags:
              - "special_edition"
              - "{rarity}" # æ”¯æŒå ä½ç¬¦
              - "migrated_item"
          # åœ¨åˆ—è¡¨å¼€å¤´æ·»åŠ å…ƒç´ 
          prepend:
            lore:
              - "This is a special item."
              - "Material: {material}, Level: {level}"

      - name: "Rule_D_GenerateUniqueIDs"
        # æ— æ¡ä»¶ï¼Œä¸ºæ‰€æœ‰ç‰©å“ç”Ÿæˆåºåˆ—ID
        actions:
          sequence:
            # ç¤ºä¾‹: ç»å…¸çš„çº¯æ•°å­—é€’å¢ï¼Œç”¨äº CustomModelData
            # å…±äº«åºåˆ—ï¼šä¸ºæ‰€æœ‰ç‰©å“ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ CustomModelData
            stats.custom_model_data:
              id: "global_custom_model_data" # <-- ä½¿ç”¨å…±äº«ID
              start: 50000
              step: 1
            # ç‹¬ç«‹åºåˆ—ï¼šæ­¤åºåˆ—çš„è®¡æ•°å™¨ä»…åœ¨æ­¤è§„åˆ™("Rule_D_GenerateUniqueIDs")å†…éƒ¨æœ‰æ•ˆ
            internal_id:
              start: 1
              step: 1
              format: 'item-v2-{counter}'

      - name: "Rule_E_DisabledExample"
        # ä¸€ä¸ªè¢«ä¸´æ—¶ç¦ç”¨çš„è§„åˆ™ï¼Œç”¨äºå±•ç¤º 'skip' åŠŸèƒ½
        conditions:
          - "material == 'wood'"
        actions:
          skip: true # å› ä¸ºæ­¤é¡¹ä¸º trueï¼Œä¸‹é¢çš„ delete æ“ä½œå°†ä¸ä¼šæ‰§è¡Œ
          delete:
            - stats.flammability

  # ===================================================================
  # == å†…å®¹è§„åˆ™é›† 2: é’ˆå¯¹ "block" ç±»å‹çš„è½¬æ¢ (ä¸€ä¸ªæ›´ç®€å•çš„ä¾‹å­)
  # ===================================================================
  - name: "Minecraft æ–¹å—æ•°æ®æ ‡å‡†åŒ–"
    content: "block" # æ­¤è§„åˆ™é›†åº”ç”¨äº 'blocks' é”®
    rules:
      - name: "StandardizeBlockProperties"
        # æ— æ¡ä»¶ï¼Œåº”ç”¨äºæ‰€æœ‰æ–¹å—
        actions:
          set:
            # ç›´æ¥åœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨ content_id
            formatted_name:
              expression: "f'Block - {content_id.replace('_', ' ').title()}'"
          append:
            properties:
              - "is_solid"
              - "auto_generated"